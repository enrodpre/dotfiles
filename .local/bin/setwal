#!/usr/bin/zsh

function usage {
  echo "$(basename $0) -h --> shows usage"
  echo "             -l --> lists themes"
  echo "             -r --> applies random theme"
  echo "             -s theme --> applies specific theme"
}

if [[ $# -eq 0 ]]
then
  usage
  exit 1
fi

wallpapers_dir=$HOME/.local/share/wallpapers


function runwal {
  wal -c
  wal -i "$1"

  xwallpaper --output HDMI-A-0 --stretch "$1"

  wal_steam -w
  pywalfox update

  $HOME/.config/polybar/scripts/pywal.sh
}

if [[ -z "$wallpaper" ]]
then
  source <(grep wallpaper ~/.cache/wal/colors.sh)
fi

optstring="lrhs:"

while getopts ${optstring} arg; do
  case ${arg} in
    h)
      usage
      exit
      ;;
    l)
      while read line; do basename $line .jpg; done <<< "$(find $wallpapers_dir -type f)" 
      exit
      ;;
    r)
      next=$(find $wallpapers_dir -type f -not -wholename $wallpaper | sort -R | head -n1)
      ;;
    s)
      if [ -z $1 ]; then
        usage
        exit
      fi

      next=$(find $wallpapers_dir -name "*$OPTARG*")
      ;;
    \? ) echo "Opcion invalida -$OPTARG"
      usage
      exit 1 ;;
    : ) echo "Opcion -$OPTARG requiere un argumento"
      usage
      exit 1 ;;
  esac 
done

[ -z $next ] && echo "Wallpaper not found" && exit 1

runwal $next
